<?php

use Icinga\Application\Config;


global $config;

$config = Config::module('hardwareinfo');

$errors = array();

error_reporting(E_ALL ^ E_DEPRECATED);

$host = $config->get('db', 'host');
$database = $config->get('db', 'name');
$user = $config->get('db', 'user');
$pswd = $config->get('db', 'password');

$dbh = mysqli_connect($host, $user, $pswd, $database);

mysqli_query($dbh, "SET names UTF8");

########################################
$q_report = "SELECT tbComputerTarget.Name AS Host,
MAX(IF(PropertyID=23,Value, NULL)) AS OSVer,
MAX(IF(PropertyID=4,Value, NULL)) AS CPU,
MAX(IF(PropertyID=3,Value, NULL)) AS CPUSpeed,
MAX(IF(PropertyID=106,Value, NULL)) AS RAMCapacity,
MAX(IF(PropertyID=107,Value, NULL)) AS RAMSpeed,
MAX(IF((PropertyID=26 AND Value NOT Like '%USB%'),Value, NULL)) AS HDD,
MAX(IF((PropertyID=31 AND Value > 33000000000),Value, NULL)) AS HDDSize,
MAX(IF((PropertyID=62 AND (Value Like '%Realtek%' OR Value Like '%Atheros%' OR Value Like '%Marvell%' OR Value Like '%NVIDIA%')),Value, NULL)) AS Net,
MAX(IF(PropertyID=74,Value, NULL)) AS Video,
MAX(IF(PropertyID=75,Value, NULL)) AS VideoRAM,
MAX(IF(PropertyID=71,Value, NULL)) AS Sound
FROM tbComputerInventory INNER JOIN
tbComputerTarget ON tbComputerInventory.ComputerTargetId = tbComputerTarget.ComputerTargetId
GROUP BY tbComputerTarget.Name;";

$r_report = mysqli_query($dbh, $q_report)  or die(mysqli_error());


?>

<div class="controls">
<?= $this->tabs ?>
</div>
<div class="content">


<h1>Hosts</h1>

<?php

echo '<table data-base-target="_next" class="common-table">';

echo '<tr><th>Host</th><th>CPU</th><th>CPU Speed</th><th>RAM Capacity</th><th>RAM Speed</th><th>HDD</th><th>HDD Size</th><th>Net</th><th>Video</th><th>Video RAM</th><th>Sound</th></tr>';

while($row = mysqli_fetch_array($r_report)) {


    echo "<tr style='cursor: pointer;' onclick=\"location='/icingaweb2/hardwareinfo/index/tree?q=".$row['Host']."'\">";
        echo "<td>".$row['Host']."</td>";
    
    //echo "<tr>";
    //    echo "<td><a href='/icingaweb2/hardwareinfo/index/tree?q=".$row['Host']."' >".$row['Host']."</a></td>";


        echo "<td>".$row['CPU']."</td>";
        echo "<td>".$row['CPUSpeed']."</td>";
        echo "<td>".$row['RAMCapacity']."</td>";
        echo "<td>".$row['RAMSpeed']."</td>";
        echo "<td>".$row['HDD']."</td>";
        echo "<td>".$row['HDDSize']."</td>";
        echo "<td>".$row['Net']."</td>";
        echo "<td>".$row['Video']."</td>";
        echo "<td>".$row['VideoRAM']."</td>";
        echo "<td>".$row['Sound']."</td>";
    echo "</tr>";

}
echo '</table>';

?>


</div>



    
